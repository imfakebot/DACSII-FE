<div class="admin-voucher-page">
  <header class="page-header">
    <h1>üé´ Qu·∫£n l√Ω Voucher</h1>
    <p class="subtitle">T·∫°o v√† qu·∫£n l√Ω m√£ gi·∫£m gi√° cho kh√°ch h√†ng</p>
  </header>

  <!-- Success/Error Messages -->
  <div *ngIf="success" class="alert alert-success">
    <svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
      <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zm-3.97-3.03a.75.75 0 0 0-1.08.022L7.477 9.417 5.384 7.323a.75.75 0 0 0-1.06 1.06L6.97 11.03a.75.75 0 0 0 1.079-.02l3.992-4.99a.75.75 0 0 0-.01-1.05z"/>
    </svg>
    {{ success }}
  </div>
  
  <div *ngIf="error" class="alert alert-error">
    <svg width="20" height="20" fill="currentColor" viewBox="0 0 16 16">
      <path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/>
      <path d="M7.002 11a1 1 0 1 1 2 0 1 1 0 0 1-2 0zM7.1 4.995a.905.905 0 1 1 1.8 0l-.35 3.507a.552.552 0 0 1-1.1 0L7.1 4.995z"/>
    </svg>
    {{ error }}
  </div>

  <!-- Create Voucher Form -->
  <section class="card create-voucher-card">
    <div class="card-header">
      <h2>T·∫°o m√£ gi·∫£m gi√° m·ªõi</h2>
    </div>
    <form (submit)="$event.preventDefault(); create();" class="voucher-form">
      <!-- Basic Info -->
      <div class="form-grid">
        <div class="form-group full-width">
          <label for="code">
            M√£ voucher <span class="required">*</span>
          </label>
          <input 
            id="code"
            type="text" 
            [(ngModel)]="code" 
            name="code" 
            placeholder="VD: SUMMER2025"
            required
            [disabled]="loading" />
          <small class="hint">M√£ duy nh·∫•t, vi·∫øt hoa, kh√¥ng d·∫•u</small>
        </div>
      </div>

      <!-- Discount Type -->
      <div class="form-group full-width">
        <label>Lo·∫°i gi·∫£m gi√° <span class="required">*</span></label>
        <div class="radio-group">
          <label class="radio-label">
            <input 
              type="radio" 
              name="discountType" 
              value="percentage"
              [(ngModel)]="discountType"
              [disabled]="loading" />
            <span>Ph·∫ßn trƒÉm (%)</span>
          </label>
          <label class="radio-label">
            <input 
              type="radio" 
              name="discountType" 
              value="amount"
              [(ngModel)]="discountType"
              [disabled]="loading" />
            <span>S·ªë ti·ªÅn c·ªë ƒë·ªãnh (VNƒê)</span>
          </label>
        </div>
      </div>

      <!-- Discount Value -->
      <div class="form-grid" *ngIf="discountType === 'percentage'">
        <div class="form-group">
          <label for="discountPercentage">
            Ph·∫ßn trƒÉm gi·∫£m <span class="required">*</span>
          </label>
          <input 
            id="discountPercentage"
            type="number" 
            [(ngModel)]="discountPercentage" 
            name="discountPercentage" 
            placeholder="VD: 20"
            min="1"
            max="100"
            [disabled]="loading" />
          <small class="hint">T·ª´ 1% ƒë·∫øn 100%</small>
        </div>

        <div class="form-group">
          <label for="maxDiscountAmount">
            Gi·∫£m t·ªëi ƒëa (VNƒê)
          </label>
          <input 
            id="maxDiscountAmount"
            type="number" 
            [(ngModel)]="maxDiscountAmount" 
            name="maxDiscountAmount" 
            placeholder="VD: 100000"
            min="0"
            [disabled]="loading" />
          <small class="hint">ƒê·ªÉ tr·ªëng = kh√¥ng gi·ªõi h·∫°n</small>
        </div>
      </div>

      <div class="form-grid" *ngIf="discountType === 'amount'">
        <div class="form-group">
          <label for="discountAmount">
            S·ªë ti·ªÅn gi·∫£m (VNƒê) <span class="required">*</span>
          </label>
          <input 
            id="discountAmount"
            type="number" 
            [(ngModel)]="discountAmount" 
            name="discountAmount" 
            placeholder="VD: 50000"
            min="1000"
            step="1000"
            [disabled]="loading" />
          <small class="hint">S·ªë ti·ªÅn gi·∫£m c·ªë ƒë·ªãnh</small>
        </div>
      </div>

      <!-- Conditions -->
      <div class="form-grid">
        <div class="form-group">
          <label for="minOrderValue">
            Gi√° tr·ªã ƒë∆°n t·ªëi thi·ªÉu (VNƒê)
          </label>
          <input 
            id="minOrderValue"
            type="number" 
            [(ngModel)]="minOrderValue" 
            name="minOrderValue" 
            placeholder="VD: 500000"
            min="0"
            step="10000"
            [disabled]="loading" />
          <small class="hint">ƒê·ªÉ tr·ªëng = √°p d·ª•ng cho m·ªçi ƒë∆°n</small>
        </div>

        <div class="form-group">
          <label for="quantity">
            S·ªë l∆∞·ª£ng <span class="required">*</span>
          </label>
          <input 
            id="quantity"
            type="number" 
            [(ngModel)]="quantity" 
            name="quantity" 
            placeholder="VD: 100"
            min="1"
            required
            [disabled]="loading" />
          <small class="hint">T·ªïng s·ªë l∆∞·ª£t s·ª≠ d·ª•ng</small>
        </div>
      </div>

      <!-- Date Range -->
      <div class="form-grid">
        <div class="form-group">
          <label for="validFrom">
            Ng√†y b·∫Øt ƒë·∫ßu <span class="required">*</span>
          </label>
          <input 
            id="validFrom"
            type="date" 
            [(ngModel)]="validFrom" 
            name="validFrom" 
            required
            [disabled]="loading" />
        </div>

        <div class="form-group">
          <label for="validTo">
            Ng√†y k·∫øt th√∫c <span class="required">*</span>
          </label>
          <input 
            id="validTo"
            type="date" 
            [(ngModel)]="validTo" 
            name="validTo" 
            required
            [disabled]="loading" />
        </div>
      </div>

      <div class="form-actions">
        <button type="submit" class="btn btn-primary" [disabled]="loading || !code">
          <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16" *ngIf="!loading">
            <path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/>
          </svg>
          {{ loading ? 'ƒêang t·∫°o...' : 'T·∫°o voucher' }}
        </button>
        <button type="button" class="btn btn-secondary" (click)="resetForm()" [disabled]="loading">
          X√≥a form
        </button>
      </div>
    </form>
  </section>

  <!-- Voucher List -->
  <section class="card vouchers-list-card">
    <div class="card-header">
      <h2>Danh s√°ch voucher</h2>
      <button class="btn btn-secondary" (click)="loadVouchers()" [disabled]="loadingVouchers">
        <svg width="16" height="16" fill="currentColor" viewBox="0 0 16 16">
          <path fill-rule="evenodd" d="M8 3a5 5 0 1 0 4.546 2.914.5.5 0 0 1 .908-.417A6 6 0 1 1 8 2v1z"/>
          <path d="M8 4.466V.534a.25.25 0 0 1 .41-.192l2.36 1.966c.12.1.12.284 0 .384L8.41 4.658A.25.25 0 0 1 8 4.466z"/>
        </svg>
        {{ loadingVouchers ? 'ƒêang t·∫£i...' : 'L√†m m·ªõi' }}
      </button>
    </div>

    <div *ngIf="vouchersError" class="alert alert-error">
      {{ vouchersError }}
    </div>

    <div *ngIf="loadingVouchers" class="loading-state">
      <div class="spinner"></div>
      <p>ƒêang t·∫£i danh s√°ch voucher...</p>
    </div>

    <div *ngIf="!loadingVouchers && vouchers.length === 0" class="empty-state">
      <svg width="64" height="64" fill="currentColor" viewBox="0 0 16 16">
        <path d="M2.5 8a5.5 5.5 0 0 1 8.25-4.764.5.5 0 0 0 .5-.866A6.5 6.5 0 1 0 14.5 8a.5.5 0 0 0-1 0 5.5 5.5 0 1 1-11 0z"/>
        <path d="M15.354 3.354a.5.5 0 0 0-.708-.708L8 9.293 5.354 6.646a.5.5 0 1 0-.708.708l3 3a.5.5 0 0 0 .708 0l7-7z"/>
      </svg>
      <p>Ch∆∞a c√≥ voucher n√†o</p>
    </div>

    <div class="voucher-grid" *ngIf="!loadingVouchers && vouchers.length > 0">
      <div *ngFor="let v of vouchers" class="voucher-card">
        <div class="voucher-code-section">
          <div class="voucher-code">{{ v.code }}</div>
          <div class="voucher-badge" [class.expired]="isExpired(v)" [class.active]="!isExpired(v)">
            {{ isExpired(v) ? 'H·∫øt h·∫°n' : 'C√≤n h·∫°n' }}
          </div>
        </div>

        <div class="voucher-details">
          <div class="detail-row">
            <span class="label">Gi·∫£m gi√°:</span>
            <span class="value highlight">
              <span *ngIf="v.discountAmount">{{ formatCurrency(v.discountAmount) }}</span>
              <span *ngIf="v.discountPercentage">{{ v.discountPercentage }}%</span>
              <span *ngIf="v.discountPercentage && v.maxDiscountAmount" class="text-muted">
                (t·ªëi ƒëa {{ formatCurrency(v.maxDiscountAmount) }})
              </span>
            </span>
          </div>

          <div class="detail-row" *ngIf="v.minOrderValue">
            <span class="label">ƒê∆°n t·ªëi thi·ªÉu:</span>
            <span class="value">{{ formatCurrency(v.minOrderValue) }}</span>
          </div>

          <div class="detail-row">
            <span class="label">S·ªë l∆∞·ª£ng:</span>
            <span class="value">{{ v.quantity }} l∆∞·ª£t</span>
          </div>

          <div class="detail-row">
            <span class="label">Th·ªùi gian:</span>
            <span class="value">{{ formatDate(v.validFrom) }} - {{ formatDate(v.validTo) }}</span>
          </div>
        </div>

        <div class="voucher-actions">
          <button 
            class="btn btn-danger btn-sm"
            (click)="confirmDelete(v.id)"
            [disabled]="deletingId !== null"
            title="X√≥a voucher">
            <svg width="14" height="14" fill="currentColor" viewBox="0 0 16 16">
              <path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/>
              <path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/>
            </svg>
            X√≥a
          </button>
        </div>

        <!-- Delete Confirmation Modal -->
        <div *ngIf="deletingId === v.id" class="modal-overlay" (click)="cancelDelete()">
          <div class="modal-content" (click)="$event.stopPropagation()">
            <h3>X√°c nh·∫≠n x√≥a</h3>
            <p>B·∫°n c√≥ ch·∫Øc mu·ªën x√≥a voucher <strong>{{ v.code }}</strong>?</p>
            <div class="modal-actions">
              <button class="btn btn-danger" (click)="deleteVoucher(v.id)">
                X√≥a
              </button>
              <button class="btn btn-secondary" (click)="cancelDelete()">
                H·ªßy
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
  </section>
</div>
