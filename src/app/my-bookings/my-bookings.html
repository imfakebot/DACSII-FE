<div class="min-h-screen bg-gradient-to-br from-slate-50 to-slate-100 p-4 md:p-8">
  <div class="max-w-7xl mx-auto space-y-6">
    
    <!-- Page Header -->
    <header class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
      <div class="flex items-center justify-between">
        <div>
          <h1 class="text-3xl font-bold text-slate-900 flex items-center gap-3">
            <span class="text-2xl">üìã</span>
            L·ªãch s·ª≠ ƒë·∫∑t s√¢n
          </h1>
          <p class="text-slate-600 mt-1">Qu·∫£n l√Ω v√† theo d√µi c√°c ƒë∆°n ƒë·∫∑t s√¢n c·ªßa b·∫°n</p>
        </div>
        <a routerLink="/" class="px-6 py-3 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-semibold rounded-lg shadow-md hover:shadow-lg transition-all flex items-center gap-2">
          <span>‚Üê</span>
          Trang ch·ªß
        </a>
      </div>
    </header>

    <!-- Success/Error Messages -->
    <div class="bg-emerald-50 text-emerald-700 rounded-lg border border-emerald-200 p-4 flex items-center gap-3 shadow-sm" *ngIf="successMessage">
      <span class="text-xl">‚úÖ</span>
      <span class="font-medium">{{ successMessage }}</span>
    </div>
    
    <div class="bg-red-50 text-red-700 rounded-lg border border-red-200 p-4 flex items-center gap-3 shadow-sm" *ngIf="error">
      <span class="text-xl">‚ö†Ô∏è</span>
      <span class="font-medium">{{ error }}</span>
    </div>

    <!-- Filters -->
    <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
      <div class="flex flex-wrap items-center gap-4">
        <label for="statusFilter" class="font-semibold text-slate-700 flex items-center gap-2">
          <span class="text-lg">üîç</span>
          L·ªçc theo tr·∫°ng th√°i:
        </label>
        <select id="statusFilter" [(ngModel)]="statusFilter" (change)="onFilterChange()"
                class="px-4 py-2.5 border-2 border-slate-300 rounded-lg focus:border-blue-500 focus:ring-2 focus:ring-blue-200 outline-none transition-all font-medium bg-white">
          <option value="">T·∫•t c·∫£</option>
          <option value="pending">Ch·ªù thanh to√°n</option>
          <option value="confirmed">ƒê√£ x√°c nh·∫≠n</option>
          <option value="checked_in">ƒê√£ check-in</option>
          <option value="completed">Ho√†n th√†nh</option>
          <option value="cancelled">ƒê√£ h·ªßy</option>
          <option value="finished">ƒê√£ k·∫øt th√∫c</option>
        </select>
      </div>
    </div>

    <!-- Loading State -->
    <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-12 text-center" *ngIf="loading">
      <div class="w-16 h-16 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
      <p class="text-lg font-medium text-slate-600">ƒêang t·∫£i danh s√°ch ƒë·∫∑t s√¢n...</p>
    </div>

    <!-- Table -->
    <div *ngIf="!loading && bookings.length > 0" class="bg-white rounded-xl shadow-md border border-slate-200 overflow-hidden">
      <div class="overflow-x-auto">
        <table class="w-full">
          <thead>
            <tr class="bg-gradient-to-r from-slate-700 to-slate-800 text-white">
              <th class="px-6 py-4 text-left font-bold text-sm uppercase tracking-wider">
                <span class="flex items-center gap-2">
                  <span>üÜî</span>
                  M√£ ƒë∆°n
                </span>
              </th>
              <th class="px-6 py-4 text-left font-bold text-sm uppercase tracking-wider">
                <span class="flex items-center gap-2">
                  <span>‚öΩ</span>
                  S√¢n
                </span>
              </th>
              <th class="px-6 py-4 text-left font-bold text-sm uppercase tracking-wider">
                <span class="flex items-center gap-2">
                  <span>üè¢</span>
                  Chi nh√°nh
                </span>
              </th>
              <th class="px-6 py-4 text-left font-bold text-sm uppercase tracking-wider">
                <span class="flex items-center gap-2">
                  <span>üïí</span>
                  B·∫Øt ƒë·∫ßu
                </span>
              </th>
              <th class="px-6 py-4 text-left font-bold text-sm uppercase tracking-wider">
                <span class="flex items-center gap-2">
                  <span>‚è±Ô∏è</span>
                  K·∫øt th√∫c
                </span>
              </th>
              <th class="px-6 py-4 text-center font-bold text-sm uppercase tracking-wider">
                <span class="flex items-center justify-center gap-2">
                  <span>‚è≥</span>
                  Th·ªùi l∆∞·ª£ng
                </span>
              </th>
              <th class="px-6 py-4 text-right font-bold text-sm uppercase tracking-wider">
                <span class="flex items-center justify-end gap-2">
                  <span>üí∞</span>
                  T·ªïng ti·ªÅn
                </span>
              </th>
              <th class="px-6 py-4 text-center font-bold text-sm uppercase tracking-wider">
                <span class="flex items-center justify-center gap-2">
                  <span>üè∑Ô∏è</span>
                  Tr·∫°ng th√°i
                </span>
              </th>
              <th class="px-6 py-4 text-center font-bold text-sm uppercase tracking-wider">
                <span class="flex items-center justify-center gap-2">
                  <span>‚öôÔ∏è</span>
                  H√†nh ƒë·ªông
                </span>
              </th>
            </tr>
          </thead>
          <tbody class="divide-y divide-slate-200">
            <tr *ngFor="let booking of bookings; let i = index" 
                class="hover:bg-blue-50 transition-colors duration-150"
                [class.bg-slate-50]="i % 2 === 0">
              <td class="px-6 py-4">
                <div class="font-mono text-sm font-semibold text-slate-900">{{ booking.id?.substring(0, 8) }}...</div>
              </td>
              <td class="px-6 py-4">
                <div class="font-medium text-slate-900">{{ booking.field?.name || booking.fieldName || '-' }}</div>
              </td>
              <td class="px-6 py-4">
                <div class="text-slate-700 text-sm">{{ booking.field?.branch?.name || '-' }}</div>
              </td>
              <td class="px-6 py-4">
                <div class="text-sm text-slate-900 whitespace-nowrap">{{ formatDateTime(booking.start_time || booking.startTime || booking.createdAt) }}</div>
              </td>
              <td class="px-6 py-4">
                <div class="text-sm text-slate-900 whitespace-nowrap">{{ formatDateTime(booking.end_time) }}</div>
              </td>
              <td class="px-6 py-4 text-center">
                <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-semibold bg-amber-100 text-amber-800">
                  {{ booking.duration_minutes || booking.duration || 0 }} ph√∫t
                </span>
              </td>
              <td class="px-6 py-4 text-right">
                <span class="text-emerald-700 font-bold text-base">{{ formatCurrency(booking.total_price || booking.finalAmount || 0) }}</span>
              </td>
              <td class="px-6 py-4 text-center">
                <span class="inline-flex items-center px-3 py-1.5 rounded-full text-xs font-bold" [ngClass]="getStatusClass(booking.status)">
                  {{ getStatusLabel(booking.status) }}
                </span>
              </td>
              <td class="px-6 py-4">
                <div class="flex items-center justify-center gap-2">
                  <button *ngIf="canPay(booking)" 
                          (click)="pay(booking.id)"
                          class="px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-sm font-semibold rounded-lg shadow-sm hover:shadow-md transition-all"
                          title="Thanh to√°n">
                    üí≥ Thanh to√°n
                  </button>
                  <button *ngIf="canCancel(booking)" 
                          (click)="openCancelModal(booking.id)"
                          class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white text-sm font-semibold rounded-lg shadow-sm hover:shadow-md transition-all"
                          title="H·ªßy ƒë∆°n">
                    ‚ùå H·ªßy
                  </button>
                  <button *ngIf="canReview(booking)" 
                          (click)="goToReview(booking.id)"
                          class="px-4 py-2 bg-gradient-to-r from-amber-500 to-yellow-500 hover:from-amber-600 hover:to-yellow-600 text-white text-sm font-semibold rounded-lg shadow-sm hover:shadow-md transition-all"
                          title="ƒê√°nh gi√° s√¢n">
                    ‚≠ê ƒê√°nh gi√°
                  </button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>

    <!-- Empty State -->
    <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-12 text-center" *ngIf="!loading && bookings.length === 0">
      <div class="text-6xl mb-4">üì≠</div>
      <p class="text-xl font-semibold text-slate-700 mb-2">B·∫°n ch∆∞a c√≥ l·ªãch s·ª≠ ƒë·∫∑t s√¢n n√†o</p>
      <p class="text-slate-500 mb-6">H√£y ƒë·∫∑t s√¢n ngay ƒë·ªÉ b·∫Øt ƒë·∫ßu!</p>
      <a routerLink="/football" class="inline-flex items-center gap-2 px-6 py-3 bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-bold rounded-lg shadow-lg hover:shadow-xl transition-all">
        <span>‚ûï</span>
        ƒê·∫∑t s√¢n ngay
      </a>
    </div>

    <!-- Pagination -->
    <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-4 flex flex-wrap items-center justify-between gap-4" *ngIf="!loading && totalPages > 1">
      <button class="px-4 py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 font-semibold rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed" 
              (click)="prevPage()" 
              [disabled]="currentPage === 1">
        ‚Üê Trang tr∆∞·ªõc
      </button>

      <div class="flex gap-2">
        <button 
          *ngFor="let page of getPageNumbers()" 
          class="px-4 py-2 rounded-lg font-semibold transition-all" 
          [class.bg-blue-600]="page === currentPage"
          [class.text-white]="page === currentPage"
          [class.shadow-md]="page === currentPage"
          [class.bg-slate-100]="page !== currentPage"
          [class.text-slate-700]="page !== currentPage"
          [class.hover:bg-slate-200]="page !== currentPage"
          (click)="goToPage(page)">
          {{ page }}
        </button>
      </div>

      <button class="px-4 py-2 bg-slate-100 hover:bg-slate-200 text-slate-700 font-semibold rounded-lg transition-colors disabled:opacity-50 disabled:cursor-not-allowed" 
              (click)="nextPage()" 
              [disabled]="currentPage === totalPages">
        Trang sau ‚Üí
      </button>

      <span class="text-slate-600 text-sm w-full md:w-auto text-center font-medium">
        Trang {{ currentPage }} / {{ totalPages }} ‚Ä¢ T·ªïng {{ totalItems }} ƒë∆°n
      </span>
    </div>
    
  </div>
</div>

<!-- Cancel Confirmation Modal -->
<div class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4" *ngIf="showCancelModal" (click)="closeCancelModal()">
  <div class="bg-white rounded-2xl max-w-md w-full shadow-2xl" (click)="$event.stopPropagation()">
    <!-- Modal Header -->
    <div class="flex items-center justify-between p-6 border-b border-slate-200">
      <h3 class="text-xl font-bold text-slate-900 flex items-center gap-3">
        <i class="fa-solid fa-exclamation-triangle text-amber-500"></i>
        X√°c nh·∫≠n h·ªßy ƒë·∫∑t s√¢n
      </h3>
      <button class="text-slate-400 hover:text-slate-600 transition" (click)="closeCancelModal()">
        <i class="fa-solid fa-times text-xl"></i>
      </button>
    </div>

    <!-- Modal Body -->
    <div class="p-6 space-y-4">
      <p class="text-slate-700">B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën h·ªßy ƒë·∫∑t s√¢n n√†y?</p>
      <div class="p-4 bg-amber-50 text-amber-700 rounded-lg border border-amber-200 flex items-start gap-3">
        <i class="fa-solid fa-info-circle mt-1"></i>
        <p class="text-sm">
          N·∫øu ƒë√£ thanh to√°n, ti·ªÅn s·∫Ω ƒë∆∞·ª£c ho√†n l·∫°i v√†o t√†i kho·∫£n (n·∫øu c√≥).
          Voucher s·ª≠ d·ª•ng s·∫Ω ƒë∆∞·ª£c ho√†n tr·∫£.
        </p>
      </div>
    </div>

    <!-- Modal Footer -->
    <div class="flex gap-3 p-6 border-t border-slate-200">
      <button class="flex-1 px-6 py-3 bg-white text-slate-600 hover:bg-slate-50 font-bold rounded-xl border border-slate-300 transition-all flex items-center justify-center gap-2" 
              (click)="closeCancelModal()">
        <i class="fa-solid fa-times"></i>
        ƒê√≥ng
      </button>
      <button class="flex-1 px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white font-bold rounded-xl shadow-lg hover:shadow-xl transition-all flex items-center justify-center gap-2" 
              (click)="confirmCancel()">
        <i class="fa-solid fa-check"></i>
        X√°c nh·∫≠n h·ªßy
      </button>
    </div>
  </div>
</div>
