<div class="max-w-7xl mx-auto p-4 md:p-8 space-y-6">
  <!-- Page Header -->
  <div class="flex items-center justify-between">
    <h1 class="text-3xl md:text-4xl font-bold text-slate-900 flex items-center gap-3">
      <i class="fa-solid fa-clock-rotate-left text-brand"></i>
      Lịch sử đặt sân
    </h1>
    <a routerLink="/" class="flex items-center gap-2 px-4 py-2 bg-white text-slate-600 hover:text-slate-900 font-medium rounded-lg border border-slate-300 hover:border-slate-400 transition">
      <i class="fa-solid fa-arrow-left"></i>
      Trang chủ
    </a>
  </div>

  <!-- Success/Error Messages -->
  <div class="p-4 bg-emerald-50 text-emerald-700 rounded-lg border border-emerald-200 flex items-center gap-2" *ngIf="successMessage">
    <i class="fa-solid fa-check-circle"></i>
    {{ successMessage }}
  </div>
  
  <div class="p-4 bg-red-50 text-red-700 rounded-lg border border-red-200 flex items-center gap-2" *ngIf="error">
    <i class="fa-solid fa-exclamation-circle"></i>
    {{ error }}
  </div>

  <!-- Filters -->
  <div class="bg-white rounded-2xl p-6 shadow-sm border border-slate-200">
    <div class="flex items-center gap-4">
      <label for="statusFilter" class="font-semibold text-slate-700 flex items-center gap-2">
        <i class="fa-solid fa-filter text-brand"></i>
        Trạng thái:
      </label>
      <select id="statusFilter" [(ngModel)]="statusFilter" (change)="onFilterChange()"
              class="border border-slate-300 rounded-lg px-4 py-2 focus:ring-2 focus:ring-brand focus:border-brand transition">
        <option value="">Tất cả</option>
        <option value="pending">Chờ thanh toán</option>
        <option value="confirmed">Đã xác nhận</option>
        <option value="checked_in">Đã check-in</option>
        <option value="completed">Hoàn thành</option>
        <option value="cancelled">Đã hủy</option>
        <option value="finished">Đã kết thúc</option>
      </select>
    </div>
  </div>

  <!-- Loading State -->
  <div class="flex flex-col items-center justify-center py-20 text-slate-500" *ngIf="loading">
    <div class="w-12 h-12 border-4 border-brand border-t-transparent rounded-full animate-spin mb-4"></div>
    <p class="text-lg">Đang tải danh sách đặt sân...</p>
  </div>

  <!-- Bookings List -->
  <div class="grid grid-cols-1 lg:grid-cols-2 gap-6" *ngIf="!loading && bookings.length > 0">
    <div class="bg-white rounded-2xl p-6 shadow-sm border border-slate-200 hover:shadow-md transition" *ngFor="let booking of bookings">
      <!-- Booking Header -->
      <div class="flex items-center justify-between mb-4 pb-4 border-b border-slate-200">
        <div class="flex items-center gap-2 text-slate-600">
          <i class="fa-solid fa-hashtag"></i>
          <span class="font-mono text-sm">{{ booking.id.substring(0, 8) }}</span>
        </div>
        <div class="px-3 py-1.5 rounded-full text-sm font-bold" [ngClass]="getStatusClass(booking.status)">
          {{ getStatusLabel(booking.status) }}
        </div>
      </div>

      <!-- Booking Body -->
      <div class="space-y-3 mb-4">
        <div class="flex items-center justify-between p-3 bg-gradient-to-br from-brand/5 to-brand/10 rounded-lg">
          <span class="text-slate-600 flex items-center gap-2">
            <i class="fa-solid fa-futbol text-brand"></i>
            Sân:
          </span>
          <span class="font-semibold text-slate-900">{{ booking.field?.name || 'N/A' }}</span>
        </div>

        <div class="flex items-center justify-between p-3 bg-slate-50 rounded-lg">
          <span class="text-slate-600 flex items-center gap-2">
            <i class="fa-solid fa-map-marker-alt text-brand"></i>
            Chi nhánh:
          </span>
          <span class="font-semibold text-slate-900">{{ booking.field?.branch?.name || 'N/A' }}</span>
        </div>

        <div class="flex items-center justify-between p-3 bg-slate-50 rounded-lg">
          <span class="text-slate-600 flex items-center gap-2">
            <i class="fa-solid fa-calendar text-brand"></i>
            Bắt đầu:
          </span>
          <span class="font-semibold text-slate-900">{{ formatDateTime(booking.start_time) }}</span>
        </div>

        <div class="flex items-center justify-between p-3 bg-slate-50 rounded-lg">
          <span class="text-slate-600 flex items-center gap-2">
            <i class="fa-solid fa-clock text-brand"></i>
            Kết thúc:
          </span>
          <span class="font-semibold text-slate-900">{{ formatDateTime(booking.end_time) }}</span>
        </div>

        <div class="flex items-center justify-between p-3 bg-slate-50 rounded-lg">
          <span class="text-slate-600 flex items-center gap-2">
            <i class="fa-solid fa-hourglass-half text-brand"></i>
            Thời lượng:
          </span>
          <span class="font-semibold text-slate-900">{{ booking.duration_minutes }} phút</span>
        </div>

        <div class="flex items-center justify-between p-4 bg-gradient-to-br from-emerald-50 to-emerald-100 rounded-lg border border-emerald-200">
          <span class="text-emerald-700 font-bold flex items-center gap-2">
            <i class="fa-solid fa-money-bill-wave"></i>
            Tổng tiền:
          </span>
          <span class="text-emerald-900 font-bold text-xl">{{ formatCurrency(booking.total_price) }}</span>
        </div>

        <div class="flex items-center justify-between p-3 bg-gradient-to-br from-amber-50 to-amber-100 rounded-lg border border-amber-200" *ngIf="booking.voucher">
          <span class="text-amber-700 font-medium flex items-center gap-2">
            <i class="fa-solid fa-ticket"></i>
            Voucher:
          </span>
          <span class="text-amber-900 font-mono font-bold">{{ booking.voucher.code }}</span>
        </div>
      </div>

      <!-- Booking Footer -->
      <div class="flex gap-3" *ngIf="canCancel(booking) || canPay(booking)">
        <button class="flex-1 bg-gradient-to-r from-brand to-purple-600 text-white font-bold py-3 rounded-xl shadow-lg hover:shadow-xl transition-all flex items-center justify-center gap-2" 
                *ngIf="canPay(booking)" 
                (click)="pay(booking.id)">
          <i class="fa-solid fa-credit-card"></i>
          Thanh toán
        </button>
        <button class="flex-1 bg-white text-red-600 hover:bg-red-50 font-bold py-3 rounded-xl border-2 border-red-600 transition-all flex items-center justify-center gap-2" 
                *ngIf="canCancel(booking)" 
                (click)="openCancelModal(booking.id)">
          <i class="fa-solid fa-times-circle"></i>
          Hủy đặt sân
        </button>
      </div>
    </div>
  </div>

  <!-- Empty State -->
  <div class="flex flex-col items-center justify-center py-20 text-center" *ngIf="!loading && bookings.length === 0">
    <div class="w-20 h-20 bg-slate-100 rounded-full flex items-center justify-center mb-4">
      <i class="fa-solid fa-inbox text-slate-400 text-3xl"></i>
    </div>
    <p class="text-xl font-semibold text-slate-600 mb-2">Bạn chưa có lịch sử đặt sân nào</p>
    <a routerLink="/" class="mt-4 bg-gradient-to-r from-brand to-purple-600 text-white font-bold px-6 py-3 rounded-xl shadow-lg hover:shadow-xl transition-all flex items-center gap-2">
      <i class="fa-solid fa-plus"></i>
      Đặt sân ngay
    </a>
  </div>

  <!-- Pagination -->
  <div class="bg-white rounded-2xl p-6 shadow-sm border border-slate-200 flex flex-wrap items-center justify-between gap-4" *ngIf="!loading && totalPages > 1">
    <button class="px-4 py-2 border border-slate-300 rounded-lg hover:bg-slate-50 transition disabled:opacity-50 disabled:cursor-not-allowed" 
            (click)="prevPage()" 
            [disabled]="currentPage === 1">
      <i class="fa-solid fa-chevron-left"></i>
    </button>

    <div class="flex gap-2">
      <button 
        *ngFor="let page of getPageNumbers()" 
        class="px-4 py-2 border rounded-lg transition" 
        [class.bg-brand]="page === currentPage"
        [class.text-white]="page === currentPage"
        [class.font-bold]="page === currentPage"
        [class.border-brand]="page === currentPage"
        [class.border-slate-300]="page !== currentPage"
        [class.hover:bg-slate-50]="page !== currentPage"
        (click)="goToPage(page)"
      >
        {{ page }}
      </button>
    </div>

    <button class="px-4 py-2 border border-slate-300 rounded-lg hover:bg-slate-50 transition disabled:opacity-50 disabled:cursor-not-allowed" 
            (click)="nextPage()" 
            [disabled]="currentPage === totalPages">
      <i class="fa-solid fa-chevron-right"></i>
    </button>

    <span class="text-slate-600 text-sm w-full md:w-auto text-center">
      Trang {{ currentPage }} / {{ totalPages }} ({{ totalItems }} kết quả)
    </span>
  </div>
</div>

<!-- Cancel Confirmation Modal -->
<div class="fixed inset-0 bg-black/50 backdrop-blur-sm flex items-center justify-center z-50 p-4" *ngIf="showCancelModal" (click)="closeCancelModal()">
  <div class="bg-white rounded-2xl max-w-md w-full shadow-2xl" (click)="$event.stopPropagation()">
    <!-- Modal Header -->
    <div class="flex items-center justify-between p-6 border-b border-slate-200">
      <h3 class="text-xl font-bold text-slate-900 flex items-center gap-3">
        <i class="fa-solid fa-exclamation-triangle text-amber-500"></i>
        Xác nhận hủy đặt sân
      </h3>
      <button class="text-slate-400 hover:text-slate-600 transition" (click)="closeCancelModal()">
        <i class="fa-solid fa-times text-xl"></i>
      </button>
    </div>

    <!-- Modal Body -->
    <div class="p-6 space-y-4">
      <p class="text-slate-700">Bạn có chắc chắn muốn hủy đặt sân này?</p>
      <div class="p-4 bg-amber-50 text-amber-700 rounded-lg border border-amber-200 flex items-start gap-3">
        <i class="fa-solid fa-info-circle mt-1"></i>
        <p class="text-sm">
          Nếu đã thanh toán, tiền sẽ được hoàn lại vào tài khoản (nếu có).
          Voucher sử dụng sẽ được hoàn trả.
        </p>
      </div>
    </div>

    <!-- Modal Footer -->
    <div class="flex gap-3 p-6 border-t border-slate-200">
      <button class="flex-1 px-6 py-3 bg-white text-slate-600 hover:bg-slate-50 font-bold rounded-xl border border-slate-300 transition-all flex items-center justify-center gap-2" 
              (click)="closeCancelModal()">
        <i class="fa-solid fa-times"></i>
        Đóng
      </button>
      <button class="flex-1 px-6 py-3 bg-gradient-to-r from-red-500 to-red-600 text-white font-bold rounded-xl shadow-lg hover:shadow-xl transition-all flex items-center justify-center gap-2" 
              (click)="confirmCancel()">
        <i class="fa-solid fa-check"></i>
        Xác nhận hủy
      </button>
    </div>
  </div>
</div>
