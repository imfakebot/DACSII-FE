<div class="admin-fields-page">
  <header class="page-header">
    <div class="header-content">
      <div class="header-title">
        <h1>‚öΩ Qu·∫£n l√Ω S√¢n</h1>
        <p class="subtitle">Qu·∫£n l√Ω v√† theo d√µi t·∫•t c·∫£ s√¢n b√≥ng trong h·ªá th·ªëng</p>
      </div>
      <div class="header-actions" *ngIf="canManage">
        <button class="btn btn-refresh" (click)="load()" [disabled]="loading">
          <span class="icon">‚Üª</span> T·∫£i l·∫°i
        </button>
        <button class="btn btn-primary" (click)="onCreate()">
          <span class="icon">+</span> T·∫°o s√¢n m·ªõi
        </button>
      </div>
    </div>
  </header>

  <!-- Branch Filter -->
  <section class="filters-section" *ngIf="canManage">
    <div class="filters-group">
      <div class="filter-item">
        <label for="branchFilter">Chi nh√°nh</label>
        <select 
          id="branchFilter" 
          [(ngModel)]="selectedBranchId" 
          (ngModelChange)="onBranchFilterChange()"
          [disabled]="!canSelectBranch"
          class="form-select"
          [class.disabled]="!canSelectBranch">
          <option value="">-- T·∫•t c·∫£ chi nh√°nh --</option>
          <option *ngFor="let branch of branches" [value]="branch.id">{{ branch.name }}</option>
        </select>
        <p *ngIf="!canSelectBranch && userBranchId" class="filter-note">
          <i class="fa-solid fa-info-circle"></i> B·∫°n ch·ªâ xem ƒë∆∞·ª£c s√¢n thu·ªôc chi nh√°nh c·ªßa m√¨nh
        </p>
      </div>

      <div class="filter-actions" *ngIf="canSelectBranch">
        <button class="btn btn-secondary" (click)="clearBranchFilter()">
          <i class="fa-solid fa-rotate-left"></i> X√≥a b·ªô l·ªçc
        </button>
      </div>
    </div>
  </section>

  <!-- Stats Cards -->
  <div class="stats-grid" *ngIf="canManage">
    <div class="stat-card stat-card--blue">
      <div class="stat-icon">‚öΩ</div>
      <div class="stat-content">
        <div class="stat-value">{{ fields.length }}</div>
        <div class="stat-label">T·ªïng s√¢n</div>
      </div>
    </div>
    <div class="stat-card stat-card--green">
      <div class="stat-icon">‚úÖ</div>
      <div class="stat-content">
        <div class="stat-value">{{ getActiveCount() }}</div>
        <div class="stat-label">ƒêang ho·∫°t ƒë·ªông</div>
      </div>
    </div>
    <div class="stat-card stat-card--red">
      <div class="stat-icon">üö´</div>
      <div class="stat-content">
        <div class="stat-value">{{ getClosedCount() }}</div>
        <div class="stat-label">T·∫°m ƒë√≥ng</div>
      </div>
    </div>
    <div class="stat-card stat-card--purple">
      <div class="stat-icon">üèóÔ∏è</div>
      <div class="stat-content">
        <div class="stat-value">{{ getTypeCount() }}</div>
        <div class="stat-label">Lo·∫°i s√¢n</div>
      </div>
    </div>
  </div>

  <div *ngIf="error" class="alert alert-error">‚ö†Ô∏è {{ error }}</div>
  <div *ngIf="!error && filteredFields?.length === 0 && !loading" class="alert alert-warning">üöß Kh√¥ng c√≥ s√¢n n√†o ph√π h·ª£p v·ªõi b·ªô l·ªçc.</div>

  <section class="card" *ngIf="canManage; else noPermission">
    <div class="card-header">
      <h2 class="card-title">Danh s√°ch s√¢n ({{ filteredFields.length }})</h2>
    </div>

    <div class="fields-grid" *ngIf="!loading; else loadingTpl">
      <div *ngFor="let f of filteredFields" class="field-card">
        <div class="field-card-header">
          <div class="field-icon">‚öΩ</div>
          <span class="status-badge" [ngClass]="getStatusClass(f.status)">
            <span class="status-dot"></span>
            {{ getStatusLabel(f.status) }}
          </span>
        </div>
        
        <div class="field-card-body">
          <h3 class="field-name">{{ f.name }}</h3>
          
          <div class="field-info">
            <div class="info-item">
              <span class="info-label">üè∑Ô∏è Lo·∫°i s√¢n:</span>
              <span class="info-value">{{ f.fieldType || f.type || 'Ch∆∞a x√°c ƒë·ªãnh' }}</span>
            </div>
            
            <div class="info-item" *ngIf="f.street || f.city">
              <span class="info-label">üìç ƒê·ªãa ch·ªâ:</span>
              <span class="info-value">{{ f.street || f.city || '-' }}</span>
            </div>
            
            <div class="info-item" *ngIf="f.description">
              <span class="info-label">üìù M√¥ t·∫£:</span>
              <span class="info-value">{{ f.description }}</span>
            </div>
          </div>
        </div>
        
        <div class="field-card-footer">
          <button class="btn-card btn-card--edit" (click)="onEdit(f.id)" title="Ch·ªânh s·ª≠a">
            <span class="icon">‚úèÔ∏è</span> S·ª≠a
          </button>
          <button class="btn-card btn-card--delete" (click)="onDelete(f.id)" title="X√≥a">
            <span class="icon">üóëÔ∏è</span> X√≥a
          </button>
        </div>
      </div>
    </div>
  </section>

  <ng-template #loadingTpl>
    <div class="loading">ƒêang t·∫£i danh s√°ch...</div>
  </ng-template>

  <ng-template #noPermission>
    <div class="alert alert-error">B·∫°n kh√¥ng c√≥ quy·ªÅn truy c·∫≠p khu v·ª±c n√†y.</div>
  </ng-template>
</div>